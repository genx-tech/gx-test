{"version":3,"sources":["../src/asyncDump.js"],"sourcesContent":["\"use strict\";\n\nconst { createHook } = require(\"async_hooks\");\nconst { stackTraceFilter } = require(\"mocha/lib/utils\");\nconst fs = require(\"fs\");\nconst allResources = new Map();\n\n// this will pull Mocha internals out of the stacks\nconst filterStack = stackTraceFilter();\n\nconst hook = createHook({\n    init(asyncId, type, triggerAsyncId) {\n        allResources.set(asyncId, { type, triggerAsyncId, stack: new Error().stack });\n    },\n    destroy(asyncId) {\n        allResources.delete(asyncId);\n    },\n}).enable();\n\nglobal.asyncDump = module.exports = (dumpFile) => {\n    hook.disable();\n\n    const logs = [];\n\n    allResources.forEach((value) => {\n        logs.push(`Type: ${value.type}`);\n        logs.push(filterStack(value.stack));\n        logs.push(\"\\n\");\n    });\n\n    fs.writeFileSync(dumpFile || \"async-dump.log\", logs.join(\"\\n\"));\n};\n"],"names":["createHook","require","stackTraceFilter","fs","allResources","Map","filterStack","hook","init","asyncId","type","triggerAsyncId","set","stack","Error","destroy","delete","enable","global","asyncDump","module","exports","dumpFile","disable","logs","forEach","value","push","writeFileSync","join"],"mappings":"AAAA,YAAY,CAAC;AAEb,MAAM,EAAEA,UAAU,CAAA,EAAE,GAAGC,OAAO,CAAC,aAAa,CAAC,AAAC;AAC9C,MAAM,EAAEC,gBAAgB,CAAA,EAAE,GAAGD,OAAO,CAAC,iBAAiB,CAAC,AAAC;AACxD,MAAME,EAAE,GAAGF,OAAO,CAAC,IAAI,CAAC,AAAC;AACzB,MAAMG,YAAY,GAAG,IAAIC,GAAG,EAAE,AAAC;AAE/B,mDAAmD;AACnD,MAAMC,WAAW,GAAGJ,gBAAgB,EAAE,AAAC;AAEvC,MAAMK,IAAI,GAAGP,UAAU,CAAC;IACpBQ,IAAI,EAACC,OAAO,EAAEC,IAAI,EAAEC,cAAc,EAAE;QAChCP,YAAY,CAACQ,GAAG,CAACH,OAAO,EAAE;YAAEC,IAAI;YAAEC,cAAc;YAAEE,KAAK,EAAE,IAAIC,KAAK,EAAE,CAACD,KAAK;SAAE,CAAC,CAAC;KACjF;IACDE,OAAO,EAACN,OAAO,EAAE;QACbL,YAAY,CAACY,MAAM,CAACP,OAAO,CAAC,CAAC;KAChC;CACJ,CAAC,CAACQ,MAAM,EAAE,AAAC;AAEZC,MAAM,CAACC,SAAS,GAAGC,MAAM,CAACC,OAAO,GAAG,CAACC,QAAQ,GAAK;IAC9Cf,IAAI,CAACgB,OAAO,EAAE,CAAC;IAEf,MAAMC,IAAI,GAAG,EAAE,AAAC;IAEhBpB,YAAY,CAACqB,OAAO,CAAC,CAACC,KAAK,GAAK;QAC5BF,IAAI,CAACG,IAAI,CAAC,CAAC,MAAM,EAAED,KAAK,CAAChB,IAAI,CAAC,CAAC,CAAC,CAAC;QACjCc,IAAI,CAACG,IAAI,CAACrB,WAAW,CAACoB,KAAK,CAACb,KAAK,CAAC,CAAC,CAAC;QACpCW,IAAI,CAACG,IAAI,CAAC,IAAI,CAAC,CAAC;KACnB,CAAC,CAAC;IAEHxB,EAAE,CAACyB,aAAa,CAACN,QAAQ,IAAI,gBAAgB,EAAEE,IAAI,CAACK,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;CACnE,CAAC"}